<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Superbowl Squares Template</title>
    <style>
        :root { 
            --primary-color: #002244; --secondary-color: #69BE28; --accent-red: #C60C30;
            --nfl-dark: #010101; --selection-yellow: #FFB81C; --stadium-dark: #0f172a;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--stadium-dark); margin: 0; padding: 0 0 250px 0; color: #f8fafc; text-align: center; }
        .hero-section { background: radial-gradient(circle at center, #1e293b 0%, #010101 100%); color: white; padding: 45px 15px; border-bottom: 5px solid var(--secondary-color); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .team-brand { font-weight: 900; color: var(--secondary-color); letter-spacing: 3px; font-size: 26px; text-transform: uppercase; margin-bottom: 5px; }
        .hero-section h1 { font-size: clamp(2.2rem, 8vw, 3.8rem); margin: 5px 0; font-weight: 900; letter-spacing: 2px; text-transform: uppercase; }
        .container { max-width: 1100px; margin: -30px auto 0 auto; width: 95%; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.6); text-align: left; box-sizing: border-box; color: #1e293b; }
        .info-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        @media (max-width: 850px) { .info-grid { grid-template-columns: 1fr; } }
        .info-card { background: #f8fafc; padding: 20px; border-radius: 12px; border-top: 4px solid var(--primary-color); box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .info-card h4 { margin: 0 0 10px 0; font-size: 14px; letter-spacing: 1px; color: var(--accent-red); text-transform: uppercase; }
        .info-card p { margin: 0; font-size: 13px; line-height: 1.5; font-weight: 500; }
        .etransfer-highlight { display: block; margin-top: 8px; font-weight: 800; color: var(--primary-color); background: #e2e8f0; padding: 5px; border-radius: 4px; text-align: center; font-size: 13px; }
        .how-to-win-navy { background: var(--primary-color); color: white; padding: 25px; border-radius: 12px; margin-bottom: 25px; border-left: 8px solid var(--secondary-color); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .how-to-win-navy h4 { margin: 0 0 15px 0; color: var(--secondary-color); font-size: 22px; text-transform: uppercase; }
        .how-to-win-navy p { font-size: 16px; line-height: 1.6; margin: 0 0 10px 0; }
        .axis-list { list-style: none; padding: 0; margin: 15px 0; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;}
        .axis-list li { margin-bottom: 8px; font-weight: 600; font-size: 16px; }
        .digit-highlight { color: var(--selection-yellow); font-size: 20px; text-decoration: underline; font-weight: 900; }
        .second-chance-bar { background: #fffbeb; border: 2px dashed var(--selection-yellow); color: #92400e; padding: 12px; border-radius: 10px; font-size: 14px; font-weight: 700; margin-bottom: 25px; text-align: center; }
        .pot-tracker { display: flex; justify-content: space-around; gap: 15px; margin: 25px 0 35px 0; border-top: 1px solid #e2e8f0; border-bottom: 1px solid #e2e8f0; padding: 20px 0; }
        .pot-card { text-align: center; flex: 1; }
        .pot-card span { font-size: 32px; font-weight: 900; color: var(--primary-color); }
        .game-wrapper { display: flex; flex-direction: column; align-items: center; margin-top: 20px; filter: drop-shadow(0 15px 25px rgba(0,0,0,0.15)); }
        .col-banner { width: 90%; margin-left: 10%; background: var(--primary-color); color: var(--secondary-color); font-weight: 900; padding: 15px 0; text-align: center; border-radius: 8px 8px 0 0; border-bottom: 4px solid var(--secondary-color); font-size: clamp(14px, 2.5vw, 20px); letter-spacing: 1px; }
        .main-row { display: flex; width: 100%; justify-content: center; align-items: stretch; }
        .row-banner { writing-mode: vertical-rl; transform: rotate(180deg); background: var(--primary-color); color: white; width: 10%; display: flex; align-items: center; justify-content: center; font-weight: 900; text-align: center; border-radius: 8px 0 0 8px; border-right: 4px solid var(--accent-red); font-size: clamp(14px, 2.5vw, 20px); letter-spacing: 1px; }
        .grid { display: grid; grid-template-columns: repeat(11, 1fr); gap: 2px; background: #cbd5e1; width: 90%; padding: 4px; border-radius: 0 0 8px 0; box-sizing: border-box; }
        .sq { aspect-ratio: 1; background: white; display: flex; align-items: center; justify-content: center; font-size: clamp(10px, 2.2vw, 17px); font-weight: 800; cursor: pointer; transition: 0.2s; }
        .axis-sq { background: #f8fafc; color: var(--primary-color); font-weight: 900; cursor: default; font-size: clamp(14px, 3vw, 20px); }
        .taken { background: #e2e8f0; color: #94a3b8; cursor: not-allowed; }
        .selected { background: var(--selection-yellow) !important; color: black !important; transform: scale(1.05); z-index: 2; }
        .team-thanks { background: #f8fafc; padding: 20px; border-radius: 12px; margin-top: 40px; text-align: center; border-left: 5px solid var(--secondary-color); border-right: 5px solid var(--accent-red); }
        #checkout-bar { position: fixed; bottom: 0; left: 0; right: 0; background: var(--nfl-dark); color: white; padding: 25px; text-align: center; z-index: 1000; display: none; border-top: 4px solid var(--secondary-color); }
        .input-field { padding: 12px; margin: 5px; border-radius: 8px; border: 1px solid #334155; width: 42%; min-width: 160px; font-size: 16px; background: #fff; color: #000; }
        .btn-confirm { background: var(--secondary-color); color: white; padding: 15px 40px; border-radius: 10px; font-weight: 900; border: none; cursor: pointer; width: 90%; max-width: 350px; margin-top: 10px; font-size: 18px; box-shadow: 0 4px 0 #4a8a1c; }
        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; color: var(--secondary-color); font-weight: 800; font-size: 24px; }
    </style>
</head>
<body>
<div id="loading-overlay">SYNCING BOARD...</div>
<div class="hero-section">
    <div class="team-brand" id="tpl-team-name">LOADING...</div>
    <h1>SUPERBOWL SQUARES</h1>
    <div style="display: flex; justify-content: center; align-items: center; margin-top: 10px;">
        <span id="sync-time" style="font-size: 12px; color: #94a3b8; font-weight: 600;">Connecting...</span>
        <button onclick="loadBoard()" style="background: rgba(105, 190, 40, 0.1); border: 1px solid var(--secondary-color); color: var(--secondary-color); padding: 5px 15px; border-radius: 20px; cursor: pointer; font-size: 12px; margin-left: 10px; font-weight: 700;">üîÑ REFRESH</button>
    </div>
</div>
<div class="container">
    <div class="info-grid">
        <div class="info-card">
            <h4>üí∞ RESERVE & PAY</h4>
            <p><b>$<span class="tpl-price">0.00</span> Per Square.</b><br><br>
            1. Click the square and add the information then pay via e-transfer<br>
            <b>OR</b><br>
            2. In message box of your e-transfer please indicate the square.<br><br>
            <b>Payment confirms your reservation about the square.</b></p>
            <span class="etransfer-highlight" id="tpl-email">...</span>
        </div>
        <div class="info-card">
            <h4>üèüÔ∏è THE GAME BOARD</h4>
            <p><b>The game board</b> includes 100 squares for players to select.</p>
            <br><br>
            <p><b>The Question Marks (?)</b> are row and column identifiers; these will be randomly assigned 0-9 before kickoff.</p>
        </div>
        <div class="info-card">
            <h4>üèÜ PRIZE POOL</h4>
            <p>50% to Team / 50% to Prizes. Winners: <b>Q1, Q2, Q3, & Final Score.</b></p>
        </div>
    </div>
    <div class="how-to-win-navy">
        <h4>üèÖ HOW TO WIN</h4>
        <p>At the end of each quarter, we match the <b>Last Digit</b> of each team's score to the grid.</p>
        <ul class="axis-list">
            <li><b>Row Number:</b> Last Digit of the <b class="row-team-name">Patriots</b> score.</li>
            <li><b>Column Number:</b> Last Digit of the <b class="col-team-name">Seahawks</b> score.</li>
        </ul>
    </div>
    <div class="second-chance-bar">üì¢ SECOND CHANCE: If a winning square is unsold, the prize is RAFFLED to all paid participants!</div>
    <div class="pot-tracker">
        <div class="pot-card"><small>Total Prize Pool</small><span id="total-pot">$0.00</span></div>
        <div style="width: 1px; background: #e2e8f0; height: 50px; align-self: center;"></div>
        <div class="pot-card"><small>Payout Per Winner</small><span id="quarter-payout">$0.00</span></div>
    </div>
    <div class="game-wrapper">
        <div class="col-banner col-team-name">SEATTLE SEAHAWKS (COLUMNS)</div>
        <div class="main-row">
            <div class="row-banner row-team-name">NEW ENGLAND PATRIOTS (ROWS)</div>
            <div id="game-board" class="grid"></div>
        </div>
    </div>
    <div class="team-thanks"><p><b>Thank you for supporting our team!</b><br>Proceeds directly support team development and travel.</p></div>
</div>
<div id="checkout-bar">
    <input type="text" id="userName" class="input-field" placeholder="Full Name (Displayed)">
    <input type="email" id="userEmail" class="input-field" placeholder="Email Address (Private)">
    <div style="margin-top:10px; font-weight: 700;">Selected: <span id="count" style="color:var(--selection-yellow)">0</span> | Total: <span id="checkout-total" style="color:var(--selection-yellow)">$0.00</span></div>
    <button onclick="submitBooking()" class="btn-confirm">CONFIRM & RESERVE</button>
</div>

<script>
    const CONFIG = {
        SCRIPT_URL: "https://script.google.com/macros/s/AKfycbwI5dEgBcwWb0Ui0C4y2eN8YSLnNrSGiu7IEfZxAvwqhTO3qHetjG5Gvgo7UH-IwHvCsA/exec",
        TEAM_NAME: "Cheetahs",
        PAYMENT_EMAIL: "cherrybeachcheetahs@gmail.com",
        SQUARE_PRICE: 20.00,
        ROW_TEAM: "New England Patriots",
        COL_TEAM: "Seattle Seahawks"
    };

    let selectedSquares = [];
    let boardData = {};

    // 1. INJECT CONFIG INTO HTML
    function init() {
        document.getElementById('tpl-team-name').innerText = `${CONFIG.TEAM_NAME} FUNDRAISER`;
        document.getElementById('tpl-email').innerText = CONFIG.PAYMENT_EMAIL;
        document.querySelectorAll('.tpl-price').forEach(el => el.innerText = CONFIG.SQUARE_PRICE.toFixed(2));
        document.querySelectorAll('.row-team-name').forEach(el => el.innerText = CONFIG.ROW_TEAM);
        document.querySelectorAll('.col-team-name').forEach(el => el.innerText = CONFIG.COL_TEAM);
        loadBoard();
    }

    // 2. LOAD BOARD FROM GOOGLE
    async function loadBoard() {
        const overlay = document.getElementById('loading-overlay');
        overlay.style.display = 'flex';
        try {
            const response = await fetch(`${CONFIG.SCRIPT_URL}?action=getBoard`);
            boardData = await response.json();
            document.getElementById('sync-time').innerText = "Last Synced: " + new Date().toLocaleTimeString();
        } catch (e) {
            console.warn("Spreadsheet connection failed. Rendering offline mode.");
        } finally {
            renderBoard();
            updateStats();
            overlay.style.display = 'none';
        }
    }

    // 3. RENDER GRID
    function renderBoard() {
        const board = document.getElementById('game-board');
        board.innerHTML = '';
        for (let r = 0; r < 11; r++) {
            for (let c = 0; c < 11; c++) {
                const sq = document.createElement('div');
                if (r === 0 && c === 0) {
                    sq.className = 'sq axis-sq';
                    sq.innerText = 'üèà';
                } else if (r === 0 || c === 0) {
                    sq.className = 'sq axis-sq';
                    sq.innerText = '?';
                } else {
                    const squareId = `R${r}C${c}`;
                    sq.className = 'sq';
                    if (boardData[squareId]) {
                        sq.classList.add('taken');
                        sq.innerText = boardData[squareId].initials || 'X';
                    } else {
                        sq.onclick = () => toggleSquare(sq, squareId);
                    }
                }
                board.appendChild(sq);
            }
        }
    }

    function toggleSquare(element, id) {
        if (selectedSquares.includes(id)) {
            selectedSquares = selectedSquares.filter(s => s !== id);
            element.classList.remove('selected');
        } else {
            selectedSquares.push(id);
            element.classList.add('selected');
        }
        updateCheckoutUI();
    }

    function updateCheckoutUI() {
        const bar = document.getElementById('checkout-bar');
        const count = selectedSquares.length;
        if (count > 0) {
            bar.style.display = 'block';
            document.getElementById('count').innerText = count;
            document.getElementById('checkout-total').innerText = `$${(count * CONFIG.SQUARE_PRICE).toFixed(2)}`;
        } else {
            bar.style.display = 'none';
        }
    }

    function updateStats() {
        const soldCount = Object.keys(boardData).length;
        const totalPrizePool = (soldCount * CONFIG.SQUARE_PRICE) * 0.5;
        document.getElementById('total-pot').innerText = `$${totalPrizePool.toFixed(2)}`;
        document.getElementById('quarter-payout').innerText = `$${(totalPrizePool / 4).toFixed(2)}`;
    }

    async function submitBooking() {
        const name = document.getElementById('userName').value;
        const email = document.getElementById('userEmail').value;
        if (!name || !email) return alert("Please fill in Name and Email.");
        
        // Form submission logic to your Google Script URL would go here
        alert(`Request Sent for squares: ${selectedSquares.join(', ')}. Please send your e-transfer now!`);
    }

    window.onload = init;
</script>
</body>
</html>
